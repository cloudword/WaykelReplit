âœ… STEP 1 â€” Force Java 17 for ALL Gradle subprojects

Open:

android/build.gradle


(âš ï¸ NOT app/build.gradle â€” the root one)

Add this at the very bottom:

allprojects {
    tasks.withType(JavaCompile).configureEach {
        sourceCompatibility = JavaVersion.VERSION_17
        targetCompatibility = JavaVersion.VERSION_17
    }
}


This overrides Capacitor plugins, including:

capacitor-geolocation

capacitor-camera

capacitor-push-notifications

âœ… STEP 2 â€” Kill Java Toolchains Completely (Mandatory)

Open:

android/gradle.properties


Ensure it contains ALL of the following:

org.gradle.java.installations.auto-detect=false
org.gradle.java.installations.auto-download=false
org.gradle.java.toolchains.auto-detect=false
org.gradle.jvmargs=-Xmx4096m


This stops Gradle from ever asking for Java 21 again.

âœ… STEP 3 â€” Force Kotlin JVM Target Globally

Still in android/build.gradle, add:

subprojects {
    tasks.withType(org.jetbrains.kotlin.gradle.tasks.KotlinCompile).configureEach {
        kotlinOptions {
            jvmTarget = "17"
        }
    }
}


This prevents Kotlin â†’ Java mismatch.

âœ… STEP 4 â€” VERIFY NO JAVA 21 ANYWHERE

Run this once (locally or just inspect):

âŒ No JavaLanguageVersion.of(21)

âŒ No VERSION_21

âŒ No toolchain {} blocks

Capacitor v6+ plugins sometimes sneak these in, so the global override is critical.

âœ… STEP 5 â€” Commit & Push
git add android/build.gradle android/gradle.properties
git commit -m "fix(android): force Java 17 across all Capacitor plugins"
git push origin dev

ğŸ¯ EXPECTED RESULT (CONFIDENT)

Next CI run:

> Task :capacitor-geolocation:compileDebugJavaWithJavac
> Task :app:assembleDebug

BUILD SUCCESSFUL


All will pass:

âœ… Build Driver App (Android)

âœ… Build Customer App (Android)

âœ… PR checks

âœ… Push checks

ğŸ§  WHY THIS WAS SO TRICKY (IMPORTANT)
Layer	Java Version
GitHub Runner	21
Gradle Default	21
Android Toolchain	17 ONLY
Capacitor Plugins	Drift to 21
Result	ğŸ’¥ silent mismatch

This is a 2024â€“2025 Android + Gradle 8 + Capacitor issue â€” you hit it early, not incorrectly.

âœ… STATUS
Issue	Status
CI Java setup	âœ…
App module Java	âœ…
Capacitor plugins	ğŸ”§ fixed now
Toolchain auto-download	âŒ disabled (correct)